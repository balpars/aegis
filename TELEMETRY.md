# ğŸ“Š HuggingFace Model Telemetry Guide

## What Was Added

The scan progress page now displays **detailed telemetry** for HuggingFace models during scans.

## ğŸ¯ When Will You See It?

The telemetry appears **ONLY during an active scan** using HuggingFace models. It shows in real-time as models process your code.

---

## ğŸ–¼ï¸ Visual Comparison

### BEFORE (Old UI)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ codebert-base                        â”‚
â”‚ Status: running                      â”‚
â”‚                                      â”‚
â”‚ Calls: 5                            â”‚
â”‚ Avg Latency: 1234ms                 â”‚
â”‚ Findings: 12                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### AFTER (New UI with Telemetry)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ codebert-base                           Status: running   â”‚
â”‚ ğŸŸ¢ CUDA:0    âš ï¸ INT8    â„¹ï¸ FP16                           â”‚
â”‚                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Calls    â”‚ Avg Lat  â”‚ Findings â”‚ Tokens   â”‚ Speed    â”‚ â”‚
â”‚ â”‚ 5        â”‚ 1234ms   â”‚ 12       â”‚ 45,234   â”‚ 125tok/s â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚ â”‚ VRAM     â”‚ Load Timeâ”‚                                   â”‚
â”‚ â”‚ 2048MB   â”‚ 3421ms   â”‚                                   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                            â”‚
â”‚ Token Breakdown:                                          â”‚
â”‚   Input: 35,123 tokens  â”‚  Output: 10,111 tokens         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ Telemetry Data Collected

### Device Information
- **CUDA:0** - GPU device (green badge)
- **MPS** - Apple Silicon GPU (blue badge)
- **CPU** - CPU only (gray badge)

### Memory Usage
- **VRAM** - GPU memory consumed by model (in MB)
- Only shown for GPU models

### Model Configuration
- **Quantization**: int4, int8 (yellow badge)
- **Precision**: fp16, fp32, bfloat16 (info badge)
- **Load Time**: Time taken to load model into memory

### Runtime Metrics (During Scan)
- **Calls**: Number of times model was invoked
- **Avg Latency**: Average response time per call
- **Findings**: Total vulnerabilities found
- **Total Tokens**: Combined input + output tokens
- **Speed**: Token generation speed (tokens/sec)

### Token Breakdown
- **Input Tokens**: Tokens sent to model (your code)
- **Output Tokens**: Tokens generated by model (findings)

---

## ğŸš€ How to See It

### Step 1: Ensure You Have HF Models

Check your Models page - you should see:
- âœ… `codebert-base-finetuned-detect-insecure-code` (enabled)
- âœ… `CodeAstra-7B` (enabled)

### Step 2: Start a Scan

1. Go to the **Scan** page
2. Upload a ZIP file with code
3. Select your HuggingFace models
4. Click **Start Scan**

### Step 3: Watch Real-Time Updates

Navigate to the **Scan Progress** page - you'll see:

1. **Model Started Event**:
   ```
   [INFO] Model started: codebert-base on cuda:0
          (2048MB VRAM, loaded in 3421ms)
   ```

2. **Model Panel Appears**:
   - Green CUDA badge appears
   - Quantization/precision badges show
   - Stats update in real-time

3. **Model Completed Event**:
   ```
   [SUCCESS] Model completed: codebert-base
             (1234ms, 12 findings, 45234 tokens, 125.3 tok/s)
   ```

---

## ğŸ” What Each Badge Means

### Device Badges
| Badge | Color | Meaning |
|-------|-------|---------|
| CUDA:0 | ğŸŸ¢ Green | NVIDIA GPU device 0 |
| CUDA:1 | ğŸŸ¢ Green | NVIDIA GPU device 1 |
| MPS | ğŸ”µ Blue | Apple Metal (M1/M2/M3) |
| CPU | âšª Gray | CPU-only execution |

### Quantization Badges
| Badge | Color | Meaning |
|-------|-------|---------|
| INT4 | ğŸŸ¡ Yellow | 4-bit quantization (smallest) |
| INT8 | ğŸŸ¡ Yellow | 8-bit quantization |

### Precision Badges
| Badge | Color | Meaning |
|-------|-------|---------|
| FP16 | ğŸ”µ Info | Half precision (faster) |
| FP32 | ğŸ”µ Info | Full precision (accurate) |
| BFLOAT16 | ğŸ”µ Info | Brain float (balanced) |

---

## ğŸ¨ UI Features

### Dynamic Grid Layout
Stats automatically adjust to fit available space:
- 2 columns on mobile
- 3-4 columns on tablet
- 5+ columns on desktop

### Conditional Display
- **Token metrics**: Only for HF/Cloud models
- **VRAM**: Only for GPU models
- **Speed**: Only if available
- **Load Time**: Always shown for first load

### Color Coding
- **Green badges**: GPU (good performance)
- **Blue badges**: MPS or precision info
- **Yellow badges**: Quantization (memory savings)
- **Gray badges**: CPU (slower)

---

## ğŸ› Troubleshooting

### "I don't see telemetry!"

**Check**:
1. âœ… Are you using HuggingFace models? (not Ollama/Cloud)
2. âœ… Is the scan actually running? (check status)
3. âœ… Did you refresh the page after updates?

### "All values show 0"

This means:
- Model hasn't been called yet
- Waiting for first chunk to process
- Give it a few seconds

### "No device badge appears"

This means:
- Model is still loading
- Telemetry collection failed (check logs)
- Model type is not HF

---

## ğŸ“ˆ Example Telemetry Output

### GPU Model (Optimal)
```
Device: CUDA:0
VRAM: 2048MB
Load Time: 3421ms
Quantization: int8
Precision: fp16
Speed: 125.3 tok/s
```

### CPU Model (Slower)
```
Device: CPU
VRAM: 0MB
Load Time: 1234ms
Quantization: None
Precision: fp32
Speed: 12.5 tok/s
```

### Cloud Model (Reference)
```
Device: N/A (Cloud API)
VRAM: N/A
Speed: 45.2 tok/s
Input Tokens: 1500
Output Tokens: 800
```

---

## ğŸ”— Related Files

- **UI Template**: `aegis/templates/scan_progress.html`
- **Telemetry Collection**: `aegis/providers/hf_local.py`
- **Event Emission**: `aegis/pipeline/executor.py`
- **Runtime Manager**: `aegis/models/runtime_manager.py`

---

## ğŸ“ Summary

**What was added**:
- âœ… Real-time HF model telemetry display
- âœ… Device/VRAM/quantization badges
- âœ… Token usage tracking
- âœ… Performance metrics

**When you'll see it**:
- ğŸ¯ During active scans using HF models
- ğŸ¯ On the scan progress page
- ğŸ¯ Updates in real-time via SSE

**What you need**:
- ğŸ“¦ HuggingFace models enabled
- ğŸ“¦ Active scan running
- ğŸ“¦ Navigate to scan progress page

---

**Next**: Just run a scan with your HF models and watch the telemetry appear!
