{% extends "base.html" %} {% block title %}aegis - Upload Source Code{% endblock
%} {% block content %}
<div class="container py-5">
  <div class="row justify-content-center mb-5">
    <div class="col-md-10 text-center">
      <div class="d-flex align-items-center justify-content-center gap-3 mb-3">
        <img src="{{ url_for('static', filename='img/aegis-logo.svg') }}" alt="Aegis" style="height: 100px;">
        <h1 class="display-4 mb-0">aegis</h1>
      </div>
      <p class="lead text-muted">
        Upload your source code (ZIP format) for comprehensive security
        vulnerability analysis using multiple AI models with consensus.
      </p>
    </div>
  </div>

  <div class="row justify-content-center">
    <div class="col-md-10">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title mb-4">
            <i class="bi bi-upload"></i> New Security Scan
          </h5>

          <form id="scanForm" enctype="multipart/form-data">
            <!-- File Upload -->
            <div class="mb-4">
              <label class="form-label">Source Code (ZIP)</label>
              <div id="dropArea" class="upload-area mb-2">
                <i class="bi bi-cloud-upload fs-1 text-muted mb-3 d-block"></i>
                <h5>Drop your ZIP file here</h5>
                <p class="text-muted mb-3">or click to browse files</p>
                <input
                  type="file"
                  id="fileInput"
                  name="file"
                  accept=".zip"
                  class="form-control"
                  style="display: none"
                  required
                />
                <button
                  type="button"
                  id="browseBtn"
                  class="btn btn-outline-primary"
                >
                  <i class="bi bi-folder2-open"></i> Browse Files
                </button>
              </div>
              <div id="fileInfo" class="alert alert-info" style="display: none">
                <i class="bi bi-file-zip"></i>
                <strong>Selected file:</strong> <span id="fileName"></span>
                <br />
                <small class="text-muted">Size: <span id="fileSize"></span></small>
              </div>
            </div>

            <!-- Model Selection -->
            <div class="mb-4">
              <label class="form-label">Models <small class="text-muted">(Select one or more)</small></label>
              <select id="modelsSelect" class="form-select" multiple size="5" required>
                <option value="" disabled>Loading models...</option>
              </select>
              <small class="text-muted d-block mt-2">
                <i class="bi bi-info-circle"></i> Hold Ctrl/Cmd to select multiple models. 
                <a href="{{ url_for('main.models_page') }}">Manage models</a>
              </small>
            </div>


            <!-- Consensus Strategy -->
            <div class="mb-4">
              <label class="form-label">Consensus Strategy</label>
              <select id="consensusStrategy" class="form-select">
                <option value="union">Union (merge all findings)</option>
                <option value="majority_vote">Majority Vote (>50% agreement)</option>
                <option value="weighted_vote">Weighted Vote</option>
                <option value="judge">Judge Model</option>
              </select>
              <div id="judgeModelSelect" class="mt-2" style="display: none;">
                <label class="form-label">Judge Model</label>
                <select id="judgeModelId" class="form-select">
                  <option value="">Select judge model...</option>
                </select>
              </div>
            </div>

            <div class="d-grid">
              <button
                type="submit"
                id="scanBtn"
                class="btn btn-danger btn-lg"
                disabled
              >
                <i class="bi bi-search"></i> Start Scan
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div
    id="scanProgress"
    class="row justify-content-center mt-5"
    style="display: none"
  >
    <div class="col-md-10">
      <div class="card">
        <div class="card-body text-center">
          <div class="spinner-border text-danger mb-3" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <h5>Scanning Your Code...</h5>
          <p class="text-muted">This may take a few minutes depending on the size of your codebase.</p>
          <div class="progress">
            <div
              class="progress-bar progress-bar-striped progress-bar-animated bg-danger"
              role="progressbar"
              style="width: 100%"
            ></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script src="{{ url_for('static', filename='js/scan.js') }}"></script>
{% endblock %}
